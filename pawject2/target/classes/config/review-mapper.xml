<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
	<mapper namespace="com.pawject.dao.review.ReviewDao">
	<resultMap type="ReviewDto" id="ReviewMap">
		<result property="reviewid"	column="REVIEWID"/>
		<result property="userid"	column="USERID"/>
		<result property="brandid"	column="BRANDID"/>
		<result property="foodid"	column="FOODID"/>
		<result property="reviewimg"	column="REVIEWIMG"/>
		<result property="rating"	column="RATING"/>
		<result property="title"	column="TITLE"/>
		<result property="reviewcomment"	column="REVIEWCOMMENT"/>
		<result property="createdat"	column="CREATEDAT"/>
		<result property="updatedat"	column="UPDATEDAT"/>

		<result property="nickname"	column="NICKNAME"/>
		<result property="brandname"	column="BRANDNAME"/>
		<result property="foodname"	column="FOODNAME"/>
		<result property="foodimg"	column="FOODIMG"/>
		<result property="pettypeid"	column="PETTYPEID"/>
		
	</resultMap>
	
	<!-- 전체 리스트 -->
	<select  resultMap="ReviewMap" id="reviewSelectAll">
		 select r.reviewid as reviewid, 
		 		fb.brandname as brandname, 
		 		f.foodid as foodid,
		 		f.foodname as foodname, 
		 		f.foodimg as foodimg, 
		 		r.reviewimg as reviewimg, 
		 		r.rating as rating, 
		 		r.title as title, 
		 		r.reviewcomment as reviewcomment, 
		 		u.nickname as nickname, 
		        TO_CHAR(f.createdat, 'YYYY-MM-DD') as createdat, 
        		TO_CHAR(f.updatedat , 'YYYY-MM-DD') as updatedat
			from review r left join food f on(r.foodid=f.foodid)
               join foodbrand fb on(r.brandid=fb.brandid)
               left join users u on(u.userid=r.userid)
            order by reviewid desc
	</select>
	
	<!-- 특정 리뷰 -->
	<select resultType="ReviewDto"  id="reviewSelect" parameterType="int">
		select * from review where reviewid=#{reviewid}
	</select>
	
	<!-- 신규 -->
	<insert id="reviewInsert" parameterType="ReviewDto">
	insert into review (reviewid, userid, brandid, foodid, reviewimg, rating, title, reviewcomment)
            values(review_seq.nextval, #{userid},#{brandid},#{foodid},#{reviewimg, jdbcType=VARCHAR},#{rating},#{title},#{reviewcomment})
	</insert>
	
	<!-- 수정 -->
	<update id="reviewUpdate" parameterType="ReviewDto">
		update review set brandid=#{brandid}, foodid=#{foodid}, reviewimg=#{reviewimg, jdbcType=VARCHAR}, 
						rating=#{rating}, title=#{title}, 
						reviewcomment=#{reviewcomment}, updatedat=sysdate
			where reviewid=#{reviewid} 
	</update>
	
	<!-- 삭제 -->
	<delete id="reviewDelete" parameterType="int">
		delete from review where reviewid=#{reviewid} 
	</delete>
	
</mapper>