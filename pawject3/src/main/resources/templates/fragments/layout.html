<!DOCTYPE html>
<html    xmlns:th="http://www.thymeleaf.org"
         xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head  lang="ko">
<meta charset="UTF-8">
<title>Insert title here</title>

<meta name="_csrf" th:content="${_csrf.token}">
<meta name="_csrf_header" th:content="${_csrf.headerName}">
    
<!-- Latest compiled and minified CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<link rel="stylesheet" th:href="@{/css/butten.css}">
<link rel="stylesheet" th:href="@{/css/review.css}">
<link rel="stylesheet" th:href="@{/css/faqlist.css}">
<link rel="stylesheet" th:href="@{/css/csboard.css}">
<link rel="stylesheet" th:href="@{/css/foodsearcher.css}">
<link rel="stylesheet" th:href="@{/css/food.css}">
<link rel="stylesheet" th:href="@{/css/mainheader.css}">



<!-- Latest compiled JavaScript -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<!-- SockJS + STOMP -->
<script src="https://cdn.jsdelivr.net/npm/sockjs-client@1.6.1/dist/sockjs.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
</head>


<body>

<!-- Toast ì•Œë¦¼ UI (ì „ì—­) -->
<div id="toast" class="toast" style="display:none; position:fixed; top:20px; right:20px; z-index:9999;">
    <span class="icon">ðŸŽ‰</span>
    <span id="toast-message"></span>
    <span id="toast-close" style="cursor:pointer;">âœ–</span>
</div>

<!-- header.html 		fragments/header íŒŒì¼ì˜ header ë¸”ë¡ -->
<th:block	th:replace="fragments/header :: header" />

<!-- content.html 		content ë¸”ë¡ ì‚½ìž… -->
<div class="container my-3">
	<th:block	layout:fragment="content" />
</div>

<!-- footer.html 		fragments/footer íŒŒì¼ì˜ footer ë¸”ë¡ -->
<th:block	th:replace="fragments/footer :: footer" />

<!-- ================= ê³µí†µ Toast UI ================= -->
<div id="toast"
     style="display:none; position:fixed; bottom:30px; right:30px;
            background:#333; color:#fff; padding:15px 20px;
            border-radius:6px; z-index:9999;">
    <span id="toast-message"></span>
    <button id="toast-close"
            style="margin-left:10px; background:none; border:none; color:#fff;">
        âœ–
    </button>
</div>

<!-- ================= WebSocket ë‹¨ì¼ ì—°ê²° ================= -->
<script th:inline="javascript">
const socket = new SockJS('/ws');
const stompClient = Stomp.over(socket);

stompClient.connect({}, () => {
  console.log("âœ… STOMP ì—°ê²° ì„±ê³µ");

  // ê°œì¸ ì•Œë¦¼ êµ¬ë…
  stompClient.subscribe('/user/queue/notifications', (msg) => {
	console.log("ðŸ“¨ ê°œì¸ ì•Œë¦¼ ìˆ˜ì‹ :", msg.body);
    showToast("ðŸŽ‰ " + msg.body);
    
    location.href = '/users/login?expired';
  });
  
  //ê³µì§€ ì•Œë¦¼
  stompClient.subscribe('/topic/announcement', (msg) => {
    alert("ðŸ“¢ ê³µì§€: " + msg.body);
  });

  // ðŸ”¥ ì—¬ê¸°ì„œ welcome í˜¸ì¶œ
  fetch('/users/welcome');
});
</script>

<!-- ================= ê³µí†µ JS ================= -->
<script>
function showToast(message) {
    const toast = document.getElementById("toast");
    const toastMessage = document.getElementById("toast-message");
    const toastClose = document.getElementById("toast-close");

    toastMessage.innerText = message;
    toast.style.display = "block";

    toastClose.onclick = () => {
        toast.style.display = "none";
    };

    setTimeout(() => {
        toast.style.display = "none";
    }, 3000);
}
</script>

<!-- íŽ˜ì´ì§€ë³„ ìŠ¤í¬ë¦½íŠ¸ -->
<th:block layout:fragment="script"/>

</body>
</html>