<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{fragments/layout}">
<head>
    <meta charset="UTF-8">
    <title>내 알림 메시지</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .notification-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            position: relative;
            transition: transform 0.2s;
        }
        .notification-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .close-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            cursor: pointer;
            color: red;
        }
        .notification-date {
            font-size: 0.9em;
            color: #666;
        }
    </style>
</head>
<body>
<div layout:fragment="content" class="container my-4">
    <h1>내 알림 메시지</h1>

    <div th:if="${#lists.isEmpty(announcements)}" class="alert alert-info">
        알림 메시지가 없습니다.
    </div>

    <div th:each="item : ${announcements}" class="notification-card">
        <strong th:text="${item.message}"></strong>
        <div class="notification-date">
            ID: <span th:text="${item.announcementId}"></span> | 작성일시: <span th:text="${item.createdAt}"></span>
        </div>
        <span class="close-btn" th:onclick="|deleteAnnouncement(${item.announcementId})|">X</span>
    </div>

    <script th:inline="javascript">
        function deleteAnnouncement(announcementId) {
            if (!confirm("정말 삭제하시겠습니까?")) return;

            const csrfToken = document.querySelector('meta[name="_csrf"]').getAttribute('content');
            const csrfHeader = document.querySelector('meta[name="_csrf_header"]').getAttribute('content');

            fetch(`/announcements/${announcementId}`, {
                method: 'DELETE',
                headers: { [csrfHeader]: csrfToken }
            }).then(res => {
                if (res.ok) {
                    location.reload();
                } else {
                    alert("삭제 실패");
                }
            });
        }
    </script>
</div>
</body>
</html>