<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      layout:decorate="~{fragments/layout}">

<head>
    <meta charset="UTF-8">
    <title>λ©”μΈ νμ΄μ§€</title>
    <!-- μ™Έλ¶€ CSS λ¶λ¬μ¤κΈ° -->
    <link rel="stylesheet" th:href="@{/css/mainpage.css}">
</head>


<body>
<div layout:fragment="content">
    <h2 class="d-none">λ©”μΈνμ΄μ§€</h2>

    <!-- μ•λ¦Ό UI -->
    <div id="toast" class="toast">
	  <span class="icon">π‰</span>
	  <span id="toast-message">νμ›κ°€μ…μ„ μ¶•ν•ν•©λ‹λ‹¤!</span>
	  <span id="toast-close">β–</span>
	</div>

	<!-- λ©”μΈ λ²„νΌ -->
		<div class="sub-area row justify-content-center text-center">
		  <div class="col-sm-6 col-md-4 mb-3">
		    <a th:href="@{/petfoodsearcher/searchpetfood}" class="main-action-btn">
		      μ‚¬λ£ μ°ΎκΈ°
		    </a>	
		  </div>
		  <div class="col-sm-6 col-md-4 mb-3">
		    <a th:href="@{/api/pet/character}" class="main-action-btn yellow">
		      μΊλ¦­ν„° μƒμ„± μ΄λ²¤νΈ
		    </a>
		  </div>
		</div>
		    	
	<!-- λ©”μΈ 3κ°€μ§€ ννΈ -->	
    <main class="main-sections"> 
    
	<section class="part">
	  <h3>μ‚¬λ£ λ¦¬λ·°</h3>
	  <p>μµκ·Ό λ“±λ΅λ λ¦¬λ·°λ¥Ό ν™•μΈν•΄ λ³΄μ„Έμ”</p>
	
	  <table class="table table-sm table-hover">
	    <thead>
	      <tr>
	        <th>μ‚¬λ£</th>
	        <th>μ λ©</th>
	        <th>λ‚΄μ©</th>
	      </tr>
	    </thead>
	    <tbody>
	      <tr th:each="r, stat : ${reviewlist}">
	        <th:block th:if="${stat.index < 5}">
	          <td th:text="${r.foodname}"></td>
	          <td th:text="${r.title}"></td>
	          <td th:text="${r.reviewcomment}"></td>
	        </th:block>
	      </tr>
	    </tbody>
	  </table>
	
	  <div class="text-end">
	    <a th:href="@{/reviewboard/reviewlist}" class="btn btn-sm btn-olive">
	      λ¦¬λ·° λ”λ³΄κΈ°
	    </a>
	  </div>
	  
	  
	</section>

        <section class="part">
            <h3>μ΄λ™ μ¤λ§νΈ</h3>
            <p>μ΄λ™ λ°©λ²•κ³Ό ν™λ™λ‰ κ΄€λ¦¬ νμ„ ν™•μΈν•μ„Έμ”.</p>
                   
		  <table class="table table-sm table-hover">
		    <thead>
		      <tr>
		        <th>μ΄λ™μ ν•</th>
		        <th>μ λ©</th>
		        <th>λ‚΄μ©</th>
		      </tr>
		    </thead>
		    <tbody>
		      <tr th:each="s, stat : ${smartlist}">
		        <th:block th:if="${stat.index < 5}">
		          <td th:text="${s.exectype}"></td>
		          <td th:text="${s.etitle}"></td>
		          <td th:text="${s.econtent}"></td>
		        </th:block>
		      </tr>
		    </tbody>
		  </table>
	
		  <div class="text-end">
		    <a th:href="@{/smart/smartlist}" class="btn btn-sm btn-olive">
		       μ΄λ™μ •λ³΄ λ”λ³΄κΈ°
		    </a>
		  </div>
        </section>

        <section class="part">
            <h3>μ§λ³‘ μ •λ³΄</h3>
            <p>μ§λ³‘ μλ°©κ³Ό μΉλ£ κ΄€λ ¨ μ •λ³΄λ¥Ό ν™•μΈν•  μ μμµλ‹λ‹¤.</p>
	  <table class="table table-sm table-hover">
	    <thead>
	      <tr>
	        <th>μ‚¬λ£</th>
	        <th>μ λ©</th>
	        <th>λ‚΄μ©</th>
	      </tr>
	    </thead>
	    <tbody>
	      <tr th:each="d, stat : ${dislist}">
	        <th:block th:if="${stat.index < 5}">
	          <td th:text="${d.disex}"></td>
	          <td th:text="${d.kindpet}"></td>
	          <td th:text="${d.infval}"></td>
	        </th:block>
	      </tr>
	    </tbody>
	  </table>
	
	  <div class="text-end">
	    <a th:href="@{/reviewboard/reviewlist}" class="btn btn-sm btn-olive">
	      μμ„Έν μ•μ•„λ³΄κΈ°
	    </a>
	  </div>
        </section>
    </main>

	

    <!-- SockJS & STOMP λΌμ΄λΈλ¬λ¦¬ -->
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>

    <script>
	  const socket = new SockJS('/ws');
	  const stompClient = Stomp.over(socket);
	
	  stompClient.connect({}, () => {
	    console.log("β… STOMP μ—°κ²° μ„±κ³µ");
	
	    // κ°μΈ μ•λ¦Ό κµ¬λ…
	    stompClient.subscribe('/user/queue/notifications', (msg) => {
	      showToast("π‰ " + msg.body);
	    });
	
	    // μ„λ²„μ— ν™μ λ©”μ‹μ§€ μ”μ²­
	    fetch('/users/welcome');
	    
	 	// λ¨λ“  μ‚¬μ©μμ—κ² λΈλ΅λ“μΊμ¤νΈλ κ³µμ§€ κµ¬λ…
        stompClient.subscribe('/topic/announcement', (msg) => {
        	console.log("κ³µμ§€ μμ‹ :", msg.body);
            showAnnouncement(msg.body);
        });
	  });
	  
	  function showAnnouncement(message) {
	        // κ°„λ‹¨ν alertλ΅ ν‘μ‹ (λ‚μ¤‘μ— UI κ°μ„  κ°€λ¥)
	        alert("π“Ά κ³µμ§€μ‚¬ν•­ μ•λ¦Ό: " + message);
	    }

	
	  function showToast(message) {
		  const toast = document.getElementById("toast");
		  const toastMessage = document.getElementById("toast-message");
		  const toastClose = document.getElementById("toast-close");

		  toastMessage.innerText = message;
		  toast.style.display = "block";

		  // λ‹«κΈ° λ²„νΌ ν΄λ¦­ μ‹ μ¦‰μ‹ μ‚¬λΌμ§€κ²
		  toastClose.onclick = () => {
		    toast.style.display = "none";
		  };
		}

	</script>

</div>
</body>
</html>
