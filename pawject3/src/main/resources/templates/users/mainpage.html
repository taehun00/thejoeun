<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      layout:decorate="~{fragments/layout}">

<head>
    <meta charset="UTF-8">
    <title>λ©”μΈ νμ΄μ§€</title>
    <!-- μ™Έλ¶€ CSS λ¶λ¬μ¤κΈ° -->
    <link rel="stylesheet" th:href="@{/css/mainpage.css}">
</head>


<body>
<div layout:fragment="content">
    <h2>λ©”μΈνμ΄μ§€</h2>

    <!-- μ•λ¦Ό UI -->
    <div id="toast" class="toast">
	  <span class="icon">π‰</span>
	  <span id="toast-message">νμ›κ°€μ…μ„ μ¶•ν•ν•©λ‹λ‹¤!</span>
	  <span id="toast-close">β–</span>
	</div>

	<!-- λ©”μΈ 3κ°€μ§€ ννΈ -->
    <main class="main-sections">
        <section class="part">
		<h3>μ‚¬λ£μ°ΎκΈ°</h3>
		<p>λ‚΄ λ°λ ¤λ™λ¬Όμ—κ² λ”± λ§λ” μ‚¬λ£λ¥Ό μ°Ύμ•„λ³΄μ„Έμ”.</p>
            <a th:href="@{/petfoodsearcher/searchpetfood}" class="btn">μμ„Έν λ³΄κΈ°</a>
        </section>

        <section class="part">
            <h3>μ΄λ™</h3>
            <p>μ΄λ™ λ°©λ²•κ³Ό ν™λ™λ‰ κ΄€λ¦¬ νμ„ ν™•μΈν•μ„Έμ”.</p>
            <a href="/exercise" class="btn">μμ„Έν λ³΄κΈ°</a>
        </section>

        <section class="part">
            <h3>μ§λ³‘</h3>
            <p>μ§λ³‘ μλ°©κ³Ό μΉλ£ κ΄€λ ¨ μ •λ³΄λ¥Ό ν™•μΈν•  μ μμµλ‹λ‹¤.</p>
            <a th:href="@{/board/list}" class="btn">μμ„Έν λ³΄κΈ°</a>
        </section>
    </main>

	

    <!-- SockJS & STOMP λΌμ΄λΈλ¬λ¦¬ -->
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>

    <script>
	  const socket = new SockJS('/ws');
	  const stompClient = Stomp.over(socket);
	
	  stompClient.connect({}, () => {
	    console.log("β… STOMP μ—°κ²° μ„±κ³µ");
	
	    // κ°μΈ μ•λ¦Ό κµ¬λ…
	    stompClient.subscribe('/user/queue/notifications', (msg) => {
	      showToast("π‰ " + msg.body);
	    });
	
	    // μ„λ²„μ— ν™μ λ©”μ‹μ§€ μ”μ²­
	    fetch('/users/welcome');
	    
	 	// λ¨λ“  μ‚¬μ©μμ—κ² λΈλ΅λ“μΊμ¤νΈλ κ³µμ§€ κµ¬λ…
        stompClient.subscribe('/topic/notifications', (msg) => {
        	console.log("κ³µμ§€ μμ‹ :", msg.body);
            showAnnouncement(msg.body);
        });
	  });
	  
	  function showAnnouncement(message) {
	        // κ°„λ‹¨ν alertλ΅ ν‘μ‹ (λ‚μ¤‘μ— UI κ°μ„  κ°€λ¥)
	        alert("π“Ά κ³µμ§€μ‚¬ν•­ μ•λ¦Ό: " + message);
	    }

	
	  function showToast(message) {
		  const toast = document.getElementById("toast");
		  const toastMessage = document.getElementById("toast-message");
		  const toastClose = document.getElementById("toast-close");

		  toastMessage.innerText = message;
		  toast.style.display = "block";

		  // λ‹«κΈ° λ²„νΌ ν΄λ¦­ μ‹ μ¦‰μ‹ μ‚¬λΌμ§€κ²
		  toastClose.onclick = () => {
		    toast.style.display = "none";
		  };
		}

	</script>

</div>
</body>
</html>