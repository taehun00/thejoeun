<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{fragments/layout}">
<head lang="ko">
    <meta charset="UTF-8">
    <meta name="_csrf" th:content="${_csrf.token}">
    <meta name="_csrf_header" th:content="${_csrf.headerName}">
    <title>ë°˜ë ¤ë™ë¬¼ ìºë¦­í„° ìƒì„±</title>
</head>
<body>
<div layout:fragment="content" class="container mt-4">

    <!-- í˜ì´ì§€ ì œëª© -->
    <h3 class="card-header mb-3">ğŸ¾ ë°˜ë ¤ë™ë¬¼ ìºë¦­í„° ìƒì„±</h3>

    <!-- ìºë¦­í„° ìƒì„± í¼ -->
    <form id="petForm" method="post" enctype="multipart/form-data">
        <div class="mb-3">
            <label for="file" class="form-label">ì›ë³¸ ì´ë¯¸ì§€ ì—…ë¡œë“œ</label>
            <input type="file" class="form-control" id="file" name="file" accept="image/*">
        </div>

        <div class="mb-3">
            <label for="kindpet" class="form-label">ë°˜ë ¤ë™ë¬¼ ì¢…</label>
            <input type="text" class="form-control" id="kindpet" name="kindpet"
                   placeholder="ì˜ˆ: ê°•ì•„ì§€, ê³ ì–‘ì´ ë“±">
        </div>

        <div class="mb-3">
            <label for="userid" class="form-label">ì‚¬ìš©ì ID</label>
            <input type="number" class="form-control" id="userid" name="userid"
                   placeholder="ì‚¬ìš©ì IDë¥¼ ì…ë ¥í•˜ì„¸ìš”">
        </div>

        <div class="text-end">
            <button type="button" class="btn btn-primary" onclick="generatePetCharacter()">ìºë¦­í„° ìƒì„±</button>
        </div>
    </form>

    <!-- ê²°ê³¼ ì˜ì—­ -->
    <div id="result" class="mt-4">
        <!-- ìƒì„±ëœ ì´ë¯¸ì§€ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
    </div>

</div>

<!-- JS ë¡œì§ -->
<script>
async function generatePetCharacter() {
    const fileInput = document.getElementById("file");
    const kindpet = document.getElementById("kindpet").value.trim();
    const userid = document.getElementById("userid").value.trim();

    if (!userid) {
        alert("ì‚¬ìš©ì IDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        return;
    }

    const token = document.querySelector('meta[name="_csrf"]').content;
    const header = document.querySelector('meta[name="_csrf_header"]').content;

    const formData = new FormData();
    if (fileInput.files.length > 0) {
        formData.append("file", fileInput.files[0]);
    }
    if (kindpet) {
        formData.append("kindpet", kindpet);
    }
    formData.append("userid", userid);

    const res = await fetch("/api/pet/character", {
        method: "POST",
        headers: {
            [header]: token
        },
        body: formData
    });

    if (!res.ok) {
        alert("AI ì´ë¯¸ì§€ ìƒì„± ì‹¤íŒ¨");
        return;
    }

    const data = await res.json();
    document.getElementById("result").innerHTML =
        `<img src="${data.url}" alt="ë°˜ë ¤ë™ë¬¼ ìºë¦­í„°" class="img-fluid rounded shadow"/>`;
}
</script>
</body>
</html>