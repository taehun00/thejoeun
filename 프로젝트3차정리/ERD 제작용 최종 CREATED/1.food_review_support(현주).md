--1. 브랜드 외래키X
CREATE TABLE FOODBRAND (
    BRANDID        NUMBER           PRIMARY KEY,
    BRANDNAME      VARCHAR2(100)    NOT NULL,
    COUNTRY        VARCHAR2(100),
    BRANDTYPE      VARCHAR2(50)     NOT NULL,   
    ORIGIN         VARCHAR2(50),             
    BRANDINFO      VARCHAR2(500)

);

--2.푸드 (FK) BRANDID : BFAND(BRANDID)/PETTYPEID : PETS(PETTYPEID) 
CREATE TABLE FOOD (
    FOODID          NUMBER          PRIMARY KEY,
    FOODNAME        VARCHAR2(100)   NOT NULL,
    BRANDID         NUMBER          NOT NULL,
    DESCRIPTION     VARCHAR2(500),
    MAININGREDIENT  VARCHAR2(200)   NOT NULL,
    SUBINGREDIENT   VARCHAR2(200),
    PETTYPEID       NUMBER          NOT NULL,
    CATEGORY        VARCHAR2(50)    NOT NULL,
    PETAGEGROUP     VARCHAR2(50),
    ISGRAINFREE     CHAR(1)         CHECK (UPPER(ISGRAINFREE) IN ('Y','N')),
    CALORIE         NUMBER(5,1),
    FOODTYPE        VARCHAR2(20),
    FOODIMG         VARCHAR2(300),
    CREATEDAT       DATE DEFAULT SYSDATE,
    UPDATEDAT       DATE DEFAULT NULL,

    CONSTRAINT FK_FOOD_BRAND FOREIGN KEY (BRANDID)
        REFERENCES FOODBRAND(BRANDID),

    CONSTRAINT FK_FOOD_PETTYPE FOREIGN KEY (PETTYPEID)
        REFERENCES PETTYPE(PETTYPEID)
);

CREATE SEQUENCE food_seq
START WITH 1 INCREMENT BY 1
NOCACHE;

--3. 영양소 외래키X
CREATE TABLE NUTRIENT(
    NUTRIENTID NUMBER PRIMARY KEY,
    NUTRIENTNAME VARCHAR2(100) NOT NULL,
    UNIT VARCHAR2(50) 
);


--4.라벨영양소 (FK) FOODID : FOOD(FOODID) / NUTRIENTID  : NUTRIENT(NUTRIENTID)
CREATE TABLE FOODNUTRIENT(
    FOODID      NUMBER NOT NULL,
    NUTRIENTID  NUMBER NOT NULL,
    AMOUNT      NUMBER,

    CONSTRAINT PK_FOODNUTRIENT PRIMARY KEY (FOODID, NUTRIENTID),

    CONSTRAINT FK_FN_FOOD FOREIGN KEY (FOODID)
        REFERENCES FOOD(FOODID)
        ON DELETE CASCADE,

    CONSTRAINT FK_FN_NUTRIENT FOREIGN KEY (NUTRIENTID)
        REFERENCES NUTRIENT(NUTRIENTID)
);

--5.영양소범위 (FK) NUTRIENTID : NUTRIENT(NUTRIENTID)		
CREATE TABLE NUTRIENTRANGE (
    RANGEID      NUMBER          PRIMARY KEY,
    PETTYPEID    NUMBER          NOT NULL,
    NUTRIENTID   NUMBER          NOT NULL,
    MINVALUE     NUMBER          NOT NULL,
    MAXVALUE     NUMBER          NOT NULL,
    RANGELABEL   VARCHAR2(50)    NOT NULL,

    CONSTRAINT FK_NR_PETTYPE FOREIGN KEY (PETTYPEID)
        REFERENCES PETTYPE(PETTYPEID),

    CONSTRAINT FK_NR_NUTRIENT FOREIGN KEY (NUTRIENTID)
        REFERENCES NUTRIENT(NUTRIENTID)
);


--6. 리뷰 (FK) USERID : USERS(USERID) / BRANDID : BRAND(BRANDID) /FOODID : FOOD(FOODID)
CREATE TABLE REVIEW (
    REVIEWID    NUMBER PRIMARY KEY,
    USERID      NUMBER NOT NULL,
    BRANDID     NUMBER,
    FOODID      NUMBER,
    RATING      NUMBER(1) CHECK (RATING BETWEEN 1 AND 5),
    TITLE       VARCHAR2(100), 
    REVIEWCOMMENT VARCHAR2(500),
    CREATEDAT   DATE DEFAULT SYSDATE,
    UPDATEDAT   DATE DEFAULT NULL,
    
    CONSTRAINT fk_review_user FOREIGN KEY (USERID)
        REFERENCES USERS(USERID),
        
    CONSTRAINT fk_review_brand FOREIGN KEY (BRANDID)
        REFERENCES FOODBRAND(BRANDID),
        
    CONSTRAINT fk_review_food FOREIGN KEY (FOODID)
        REFERENCES FOOD(FOODID)
);

CREATE SEQUENCE REVIEW_SEQ
START WITH 1 INCREMENT BY 1
NOCACHE;

--7. 리뷰이미지  (FK)	REVIEWID : REVIEW(REVIEWID)	
CREATE TABLE REVIEWIMG (
    REVIEWIMGID NUMBER PRIMARY KEY,
    REVIEWID NUMBER, 
    REVIEWIMGNAME VARCHAR2(300) NOT NULL,
    CREATEDAT DATE DEFAULT SYSDATE,
    FOREIGN KEY (REVIEWID) REFERENCES REVIEW(REVIEWID)
);

CREATE SEQUENCE REVIEWIMG_SEQ
START WITH 1 INCREMENT BY 1
NOCACHE;

--신규
--8. 1:1질문 (FK)USERID : USERS(USERID)
CREATE TABLE CSQUESTION(
  QUESTIONID NUMBER PRIMARY KEY,
  USERID NUMBER NOT NULL,
  CATEGORY VARCHAR2(50),
  TITLE VARCHAR2(200) NOT NULL,
  CONTENT CLOB NOT NULL,
  STATUS NUMBER(1) DEFAULT 0,   
  CREATEDAT DATE DEFAULT SYSDATE,
   CONSTRAINT fk_csquestion_user FOREIGN KEY (USERID)
        REFERENCES USERS(USERID) 
  
);


--9. 1:1답변 (FK)QUESTIONID : CSQUESTION(QUESTIONID)/(FK)ADMINID : USERS(USERID)
CREATE TABLE CSANSWER(
  ANSWERID NUMBER PRIMARY KEY,
  QUESTIONID NUMBER NOT NULL,
  ADMINID NUMBER NOT NULL,
  CONTENT CLOB NOT NULL,
  CREATEDAT DATE DEFAULT SYSDATE,
      CONSTRAINT fk_csanswer_question FOREIGN KEY (QUESTIONID)
        REFERENCES CSQUESTION(QUESTIONID),
        
        CONSTRAINT fk_csanswer_admin FOREIGN KEY (ADMINID)
        REFERENCES USERS(USERID)
);

CREATE SEQUENCE CSANSWER_SEQ 
START WITH 1 INCREMENT BY 1
NOCACHE;

--10. FAQ 외래키X
CREATE TABLE FAQ (
  FAQID NUMBER PRIMARY KEY,
  CATEGORY VARCHAR2(50),
  QUESTION VARCHAR2(500) NOT NULL,
  ANSWER CLOB NOT NULL,
  KEYWORDS VARCHAR2(500),
  ISACTIVE NUMBER(1) DEFAULT 1 NOT NULL,
  CREATEDAT DATE DEFAULT SYSDATE,
  UPDATEDAT DATE
);

CREATE SEQUENCE FAQ_SEQ
START WITH 1 INCREMENT BY 1
NOCACHE;
