-- 유저 테이블
CREATE TABLE USERS (
    USERID     NUMBER,                      -- PK, 자동 증가
    EMAIL      VARCHAR2(200) NOT NULL,                  -- 이메일
    NICKNAME   VARCHAR2(100) NOT NULL,                  -- 별명
    PASSWORD   VARCHAR2(100) NOT NULL,                  -- 비밀번호
    UFILE      VARCHAR2(255),                           -- 이미지 파일명
    CREATEDAT  DATE DEFAULT SYSDATE,                    -- 등록일
    MOBILE     VARCHAR2(200),                           -- 전화번호
    PROVIDER   VARCHAR2(50) NOT NULL,                   -- 인증 제공자(local, google, kakao 등)
    PROVIDERID VARCHAR2(100),                           -- 제공자 id
    CONSTRAINT pk_users PRIMARY KEY (USERID),
    CONSTRAINT uq_users_email_provider UNIQUE (EMAIL, PROVIDER)
);

CREATE SEQUENCE users_seq;


-- 권한 테이블 (ROLE_ADMIN or ROLE_MEMBER)
CREATE TABLE ROLES (
    AUTHID   NUMBER          PRIMARY KEY,     -- 권한 고유 ID
    USERID   NUMBER          NOT NULL,
    EMAIL    VARCHAR2(100)   NOT NULL,        -- 사용자 이메일 (FK 아직 없음)
    AUTH     VARCHAR2(100)   NOT NULL         -- 권한 (예: ROLE_ADMIN, ROLE_MEMBER)
);
ALTER TABLE ROLES
    ADD CONSTRAINT FK_ROLES_USER FOREIGN KEY (USERID)
    REFERENCES USERS (USERID);




-- 펫 테이블
CREATE TABLE PETS (
    PETID          NUMBER          PRIMARY KEY,        -- 반려동물 고유 ID
    USERID         NUMBER          NOT NULL,           -- 사용자 ID
    PETNAME        VARCHAR2(100)   NOT NULL,           -- 반려동물 이름
    PETBREED       VARCHAR2(100),                      -- 반려동물 종
    BIRTHDATE      VARCHAR2(100),                      -- 생년월일
    PETTYPEID      NUMBER          NOT NULL,           -- 반려동물 종류 ID
    PFILE          VARCHAR2(255),                      -- 반려동물 이미지 파일명
    CREATEDAT      DATE            DEFAULT SYSDATE,    -- 등록일
    PAGE           NUMBER,                             -- 나이
    PGENDER        VARCHAR2(10)                        -- 성별
);
ALTER TABLE PETS
    ADD CONSTRAINT fk_pets_userid FOREIGN KEY (USERID)
        REFERENCES USERS (USERID);

ALTER TABLE PETS
    ADD CONSTRAINT fk_pets_pettype FOREIGN KEY (PETTYPEID)
        REFERENCES PETTYPE (PETTYPEID);

CREATE SEQUENCE pets_seq;


-- 펫 타입 테이블( 강아지, 고양이 선택 )
CREATE TABLE PETTYPE (
    pettypeid   NUMBER          PRIMARY KEY,
    pettypename VARCHAR2(100)   NOT NULL
);





-- 공지사항 내용 db 저장 테이블
CREATE TABLE ANNOUNCEMENT (
    ID NUMBER PRIMARY KEY,
    MESSAGE VARCHAR2(1000) NOT NULL,
    CREATEDAT DATE DEFAULT SYSDATE
);

CREATE SEQUENCE ANNOUNCEMENT_seq;



-- 알림 숨김 테이블( 사용자가 x 버튼을 누르면 해당 사용자 알림 삭제 )
CREATE TABLE HIDDENANNOUNCEMENT (
    USERID NUMBER NOT NULL,
    ANNOUNCEMENTID NUMBER NOT NULL,
    PRIMARY KEY (USERID, ANNOUNCEMENTID)
);

ALTER TABLE HIDDENANNOUNCEMENT 
ADD CONSTRAINT FK_HID_ANN_ID 
FOREIGN KEY (ANNOUNCEMENTID) 
REFERENCES ANNOUNCEMENT (ID) 
ON DELETE CASCADE;

ALTER TABLE HIDDENANNOUNCEMENT 
ADD CONSTRAINT FK_HIDDENANNOUNCEMENT_USER 
FOREIGN KEY (USERID) 
REFERENCES USERS (USERID) 
ON DELETE CASCADE;
