-- 펫 정보 작성
INSERT INTO PETS (
            PETID, USERID, PETNAME, PETBREED, BIRTHDATE, PETTYPEID,
            PFILE, CREATEDAT, AGE, GENDER, WEIGHT, HEIGHT, BODYSCORE, ACTIVITYLEVEL
        ) VALUES (
            #{petId}, #{userId}, #{petName}, #{petBreed}, #{birthDate}, #{petTypeId},
            #{pfile}, SYSDATE, #{age}, #{gender}, #{weight}, #{height}, #{bodyScore}, #{activityLevel}
        )

INSERT INTO PETDISEASE (
            PETDISEASEID, PETID, DISEASEID
        ) VALUES (
            #{petDiseaseId}, #{petId}, #{diseaseId}
        )
INSERT INTO PETFOOD (
            PETFOODID, PETID, FOODID
        ) VALUES (
            #{petFoodId}, #{petId}, #{foodId}
        )

-- 펫 모든 정보 조회(질병, 음식까지)
SELECT 
    p.PETID,
    p.USERID,
    p.PETNAME,
    p.PETBREED,
    p.BIRTHDATE,
    p.PETTYPEID,
    p.PFILE,
    p.CREATEDAT,
    p.AGE,
    p.GENDER,
    p.WEIGHT,
    p.HEIGHT,
    p.BODYSCORE,
    p.ACTIVITYLEVEL,
    d.DISNAME      AS DISEASE_NAME,
    f.FOODNAME     AS FOOD_NAME
FROM PETS p
LEFT JOIN PETDISEASE pd ON p.PETID = pd.PETID
LEFT JOIN DISEASE d ON pd.DISEASEID = d.DISNO
LEFT JOIN PETFOOD pf ON p.PETID = pf.PETID
LEFT JOIN FOOD f ON pf.FOODID = f.FOODID;

-- 어떤 브랜드의 음식이 많이 리뷰되었는지
SELECT 
    fb.BRANDNAME,
    f.FOODNAME,
    COUNT(*) AS REVIEW_COUNT
FROM NOTIFICATION_A na
JOIN REVIEW r ON na.REVIEWID = r.REVIEWID
JOIN FOOD f ON r.FOODID = f.FOODID
JOIN FOODBRAND fb ON f.BRANDID = fb.BRANDID
GROUP BY fb.BRANDNAME, f.FOODNAME
ORDER BY fb.BRANDNAME, REVIEW_COUNT DESC;



-- 어떤 브랜드(만)가 많이 리뷰되었는지
SELECT 
    fb.BRANDNAME,
    COUNT(*) AS REVIEW_COUNT
FROM NOTIFICATION_A na
JOIN REVIEW r ON na.REVIEWID = r.REVIEWID
JOIN FOOD f ON r.FOODID = f.FOODID
JOIN FOODBRAND fb ON f.BRANDID = fb.BRANDID
GROUP BY fb.BRANDNAME
ORDER BY REVIEW_COUNT DESC;



-- 새로운 알림
INSERT INTO NOTIFICATION_M (notificationMID, USERID, BOARDTYPE, TYPE, MESSAGE, CREATEDAT)
VALUES (304, 1, '운동정보', 'CREATE', '운동정보 게시판에 새로운 정보가 등록됐습니다.', SYSDATE);




-- 회원가입 시 알림 기본 셋팅
-- 운동정보 알림 기본 ON
INSERT INTO NOTIFICATION_SETTING (SETTINGID, USERID, TYPE, ENABLED)
VALUES (setting_seq.NEXTVAL, 1, '운동정보', 'Y');

-- 질병 알림 기본 ON
INSERT INTO NOTIFICATION_SETTING (SETTINGID, USERID, TYPE, ENABLED)
VALUES (setting_seq.NEXTVAL, 1, '질병', 'Y');

-- 사료 알림 기본 ON
INSERT INTO NOTIFICATION_SETTING (SETTINGID, USERID, TYPE, ENABLED)
VALUES (setting_seq.NEXTVAL, 1, '사료', 'Y');



-- 사용자가 알림 끄기 요청 시
UPDATE NOTIFICATION_SETTING
SET ENABLED = 'N'
WHERE USERID = 1 AND TYPE = '운동정보';


-- 사용자가 받을 수 있는 알림 조회 (설정이 Y인 경우만)
SELECT nm.*
FROM NOTIFICATION_M nm
JOIN NOTIFICATION_SETTING ns 
  ON nm.USERID = ns.USERID 
AND nm.BOARDTYPE = ns.TYPE
WHERE ns.ENABLED = 'Y';



-- 알림 설정
UPDATE NOTIFICATION_SETTING
SET ENABLED = 'N'
WHERE USERID = 1 AND TYPE = '운동정보';
