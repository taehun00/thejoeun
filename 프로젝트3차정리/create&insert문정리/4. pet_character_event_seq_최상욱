ai 생성여부로 확인 못함(구현 못함 , 시간 필요)


이름                널?       유형            
----------------- -------- ------------- 
EVENT_ID          NOT NULL NUMBER        
USER_ID           NOT NULL NUMBER        
PROMPT_TEXT                CLOB          
ORIGIN_IMAGE_URL           VARCHAR2(500) 
ORIGIN_IMAGE_NAME          VARCHAR2(255) 
ORIGIN_IMAGE_SIZE          NUMBER        
AI_IMAGE_URL               VARCHAR2(500) 
AI_MODEL                   VARCHAR2(50)  
REQUEST_STATUS    NOT NULL VARCHAR2(20)  
SATISFACTION               CHAR(1)       
REGEN_COUNT                NUMBER        
CREATED_AT                 DATE          
UPDATED_AT                 DATE  


desc PET_CHARACTER_EVENT;

CREATE TABLE PET_CHARACTER_EVENT (
    EVENT_ID            NUMBER              NOT NULL,
    USER_ID             NUMBER              NOT NULL,
    PROMPT_TEXT         CLOB,
    ORIGIN_IMAGE_URL    VARCHAR2(500),
    ORIGIN_IMAGE_NAME   VARCHAR2(255),
    ORIGIN_IMAGE_SIZE   NUMBER,
    AI_IMAGE_URL        VARCHAR2(500),
    AI_MODEL            VARCHAR2(50),
    REQUEST_STATUS      VARCHAR2(20)        DEFAULT 'REQUESTED' NOT NULL,
    SATISFACTION        CHAR(1)             DEFAULT 'N',
    REGEN_COUNT         NUMBER              DEFAULT 0,
    CREATED_AT          DATE                DEFAULT SYSDATE,
    UPDATED_AT          DATE                DEFAULT SYSDATE
   
);

create sequence pet_character_event_seq;

INSERT INTO PET_CHARACTER_EVENT (
    EVENT_ID,
    USER_ID,
    PROMPT_TEXT,
    ORIGIN_IMAGE_URL,
    ORIGIN_IMAGE_NAME,
    ORIGIN_IMAGE_SIZE,
    REQUEST_STATUS,
    CREATED_AT,
    UPDATED_AT
) VALUES (
    pet_character_event_seq.NEXTVAL, -- 시퀀스로 ID 생성
    :userId,                            -- 사용자 ID (예: 55021)
    :promptText,                        -- 프롬프트 내용 (예: '귀여운 강아지 캐릭터 만들어줘')
    :originImageUrl,                    -- 업로드된 이미지 경로 (예: '/uploads/2025/dog.jpg')
    :originImageName,                   -- 원본 파일명 (예: 'dog.jpg')
    :originImageSize,                   -- 파일 크기 (예: 10240)
    'REQUESTED',                        -- 초기 상태
    SYSDATE,
    SYSDATE
);
-- 2. R (Read): 조회
-- 2-1. 관리자용: 전체 사용자가 생성한 이미지 검색 (최신순)
SELECT 
    EVENT_ID,
    USER_ID,
    PROMPT_TEXT,
    ORIGIN_IMAGE_URL,
    AI_IMAGE_URL,
    REQUEST_STATUS,
    CREATED_AT
FROM PET_CHARACTER_EVENT
ORDER BY CREATED_AT DESC;
-- 2-2. 사용자용: 본인이 생성한 캐릭터 및 요청 상태 조회
SELECT 
    EVENT_ID,
    PROMPT_TEXT,
    ORIGIN_IMAGE_URL,
    AI_IMAGE_URL,
    REQUEST_STATUS,
    SATISFACTION,
    CREATED_AT
FROM PET_CHARACTER_EVENT
WHERE USER_ID = :userId  -- 로그인한 사용자 ID
ORDER BY CREATED_AT DESC;

-- 3. U (Update): 미사용 (요청사항에 따라 생략)

-- 4. D (Delete): 삭제
-- 4-1. 사용자/관리자 공통: 특정 캐릭터(이벤트) 삭제
-- 사용자가 불만족하거나 관리자가 삭제할 때 사용

DELETE FROM PET_CHARACTER_EVENT
WHERE EVENT_ID = :eventId;

-- (선택사항) 사용자 본인 확인을 포함한 안전한 삭제 SQL
-- DELETE FROM PET_CHARACTER_EVENT
-- WHERE EVENT_ID = :eventId AND USER_ID = :userId;

-- 예제 1: 강아지를 슈퍼히어로 스타일로 변환 요청
INSERT INTO PET_CHARACTER_EVENT (
    EVENT_ID,
    USER_ID,
    PROMPT_TEXT,
    ORIGIN_IMAGE_URL,
    ORIGIN_IMAGE_NAME,
    ORIGIN_IMAGE_SIZE,
    REQUEST_STATUS,
    CREATED_AT,
    UPDATED_AT
) VALUES (
    pet_character_event_seq.NEXTVAL,
    55021,
    '우리 강아지를 마블 슈퍼히어로처럼 웅장하게 그려줘, 망토를 입혀줘',
    '/uploads/2025/01/dog_hero.jpg',
    'dog_hero.jpg',
    204800,
    'REQUESTED',
    SYSDATE,
    SYSDATE
);
-- 예제 2: 고양이를 수채화 풍으로 변환 요청
INSERT INTO PET_CHARACTER_EVENT (
    EVENT_ID,
    USER_ID,
    PROMPT_TEXT,
    ORIGIN_IMAGE_URL,
    ORIGIN_IMAGE_NAME,
    ORIGIN_IMAGE_SIZE,
    REQUEST_STATUS,
    CREATED_AT,
    UPDATED_AT
) VALUES (
    pet_character_event_seq.NEXTVAL,
    55022,
    '따뜻한 느낌의 수채화 스타일로 고양이를 그려줘, 꽃밭에 있는 것처럼',
    '/uploads/2025/01/cat_watercolor.png',
    'cat_watercolor.png',
    153600,
    'REQUESTED',
    SYSDATE,
    SYSDATE
);
-- 예제 3: 햄스터를 사이버펑크 스타일로 변환 요청
INSERT INTO PET_CHARACTER_EVENT (
    EVENT_ID,
    USER_ID,
    PROMPT_TEXT,
    ORIGIN_IMAGE_URL,
    ORIGIN_IMAGE_NAME,
    ORIGIN_IMAGE_SIZE,
    REQUEST_STATUS,
    CREATED_AT,
    UPDATED_AT
) VALUES (
    pet_character_event_seq.NEXTVAL,
    55023,
    '미래 도시의 사이버펑크 스타일 햄스터, 네온 사인 배경',
    '/uploads/2025/01/hamster_cyber.jpg',
    'hamster_cyber.jpg',
    102400,
    'REQUESTED',
    SYSDATE,
    SYSDATE
);
