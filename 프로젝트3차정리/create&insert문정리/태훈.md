drop table authorities;
drop table pet;
drop table execboard;
drop table disease;
drop table reviewimg;
drop table review;
drop table users;

CREATE TABLE USERS (
    USERID       NUMBER          PRIMARY KEY,         -- 기본키
    EMAIL        VARCHAR2(200)   NOT NULL UNIQUE,     -- 이메일 (유니크)
    NICKNAME     VARCHAR2(100)   NOT NULL,            -- 별명(이름)
    PASSWORD     VARCHAR2(100)   NOT NULL,            -- 비밀번호
    UFILE        VARCHAR2(255),                       -- 이미지 파일명
    CREATEDAT    DATE            DEFAULT SYSDATE,     -- 등록일
    MOBILE       VARCHAR2(200),                       -- 전화번호
    PROVIDER     VARCHAR2(50),                        -- 인증 제공자(local, google 등)
    PROVIDERID   VARCHAR2(100)                        -- 제공자 id
);

CREATE TABLE ROLES (
    AUTHID   NUMBER          PRIMARY KEY,     -- 권한 고유 ID
    EMAIL    VARCHAR2(100)   NOT NULL,        -- 사용자 이메일 (FK 아직 없음)
    AUTH     VARCHAR2(100)   NOT NULL         -- 권한 (예: ROLE_ADMIN, ROLE_MEMBER)
);
ALTER TABLE ROLES
    ADD CONSTRAINT fk_roles_email FOREIGN KEY (EMAIL)
        REFERENCES USERS (EMAIL);

CREATE TABLE PETS (
    PETID          NUMBER          PRIMARY KEY,        -- 반려동물 고유 ID
    USERID         NUMBER          NOT NULL,           -- 사용자 ID (FK → USERS.USERID)
    PETNAME        VARCHAR2(100)   NOT NULL,           -- 반려동물 이름
    PETBREED       VARCHAR2(100),                      -- 반려동물 종 (예: 페르시안, 푸들)
    BIRTHDATE      VARCHAR2(100),                      -- 생년월일 (문자열로 저장)
    PETTYPEID      NUMBER          NOT NULL,           -- 반려동물 종류 ID (FK → PETTYPE.PETTYPEID)
    PFILE          VARCHAR2(255),                      -- 반려동물 이미지 파일명
    CREATEDAT      DATE            DEFAULT SYSDATE,    -- 등록일
    AGE            NUMBER,                             -- 나이
    GENDER         VARCHAR2(10),                       -- 성별 (M/F)
    WEIGHT         NUMBER,                             -- 체중
    HEIGHT         NUMBER,                             -- 키/몸길이
    BODYSCORE      NUMBER,                             -- 비만지표 (1~5)
    ACTIVITYLEVEL  NUMBER                              -- 활동량 (1~3)
);

-- 외래키 제약조건 추가
ALTER TABLE PETS
    ADD CONSTRAINT fk_pets_userid FOREIGN KEY (USERID)
        REFERENCES USERS (USERID);

ALTER TABLE PETS
    ADD CONSTRAINT fk_pets_pettype FOREIGN KEY (PETTYPEID)
        REFERENCES PETTYPE (PETTYPEID);


CREATE TABLE PETDISEASE (
    PETDISEASEID NUMBER PRIMARY KEY,   -- 펫질병 고유 ID
    PETID        NUMBER NOT NULL,      -- 반려동물 ID (FK 예정 → PETS.PETID)
    DISEASEID    NUMBER NOT NULL       -- 질병 ID (FK 예정 → DISEASE.DISNO)
);

-- PETS 테이블 참조
ALTER TABLE PETDISEASE
    ADD CONSTRAINT fk_petdisease_pet FOREIGN KEY (PETID)
        REFERENCES PETS (PETID);

-- DISEASE 테이블 참조
ALTER TABLE PETDISEASE
    ADD CONSTRAINT fk_petdisease_disease FOREIGN KEY (DISEASEID)
        REFERENCES DISEASE (DISNO);
        
CREATE TABLE PETFOOD (
    PETFOODID NUMBER PRIMARY KEY,   -- 펫음식 고유 ID
    PETID     NUMBER NOT NULL,      -- 반려동물 ID (FK 예정 → PETS.PETID)
    FOODID    NUMBER NOT NULL       -- 음식 ID (FK 예정 → FOOD.FOODID)
);

-- PETS 테이블 참조
ALTER TABLE PETFOOD
    ADD CONSTRAINT fk_petfood_pet FOREIGN KEY (PETID)
        REFERENCES PETS (PETID);

-- FOOD 테이블 참조
ALTER TABLE PETFOOD
    ADD CONSTRAINT fk_petfood_food FOREIGN KEY (FOODID)
        REFERENCES FOOD (FOODID);
        
CREATE TABLE NOTIFICATION_A (
    notificationAID NUMBER PRIMARY KEY,   -- 알림 고유 ID
    USERID           NUMBER NOT NULL,      -- 사용자 ID (FK 예정 → USERS.USERID)
    REVIEWID         NUMBER NOT NULL,      -- 리뷰 ID (FK 예정 → REVIEW.REVIEWID)
    MESSAGE          VARCHAR2(255),        -- 알림 메시지
    CREATEDAT        DATE DEFAULT SYSDATE  -- 생성일
);

-- USERS 테이블 참조
ALTER TABLE NOTIFICATION_A
    ADD CONSTRAINT fk_notia_user FOREIGN KEY (USERID)
        REFERENCES USERS (USERID);

-- REVIEW 테이블 참조
ALTER TABLE NOTIFICATION_A
    ADD CONSTRAINT fk_notia_review FOREIGN KEY (REVIEWID)
        REFERENCES REVIEW (REVIEWID);

CREATE TABLE NOTIFICATION_M (
    notificationMID NUMBER PRIMARY KEY,
    USERID          NUMBER NOT NULL,
    BOARDTYPE       VARCHAR2(50) NOT NULL,
    TYPE            VARCHAR2(50) NOT NULL,
    MESSAGE         VARCHAR2(255),
    CREATEDAT       DATE DEFAULT SYSDATE
);

ALTER TABLE NOTIFICATION_M
    ADD CONSTRAINT fk_notim_user FOREIGN KEY (USERID)
        REFERENCES USERS (USERID);

CREATE TABLE NOTIFICATION (
    NOTIFICATIONID NUMBER PRIMARY KEY,   -- 알림 고유 ID
    BOARDTYPE      VARCHAR2(50) NOT NULL,-- 게시판 타입 (운동정보, 질병, 사료 등)
    TYPE           VARCHAR2(50) NOT NULL,-- 알림 유형 (CREATE, UPDATE, DELETE)
    MESSAGE        VARCHAR2(255)         -- 알림 메시지
);

ALTER TABLE NOTIFICATION
    ADD CONSTRAINT fk_notification_boardtype_type 
    FOREIGN KEY (BOARDTYPE, TYPE)
    REFERENCES NOTIFICATION_M (BOARDTYPE, TYPE);
    
INSERT INTO NOTIFICATION (NOTIFICATIONID, BOARDTYPE, TYPE, MESSAGE)
VALUES (1, '운동정보', 'CREATE', '운동정보 게시판에 새로운 정보가 등록됐습니다.');

INSERT INTO NOTIFICATION (NOTIFICATIONID, BOARDTYPE, TYPE, MESSAGE)
VALUES (2, '운동정보', 'UPDATE', '운동정보 게시판에 정보가 업데이트됐습니다.');

INSERT INTO NOTIFICATION (NOTIFICATIONID, BOARDTYPE, TYPE, MESSAGE)
VALUES (3, '운동정보', 'DELETE', '운동정보 게시판에 정보가 삭제됐습니다.');

INSERT INTO NOTIFICATION (NOTIFICATIONID, BOARDTYPE, TYPE, MESSAGE)
VALUES (4, '질병', 'CREATE', '질병 게시판에 새로운 정보가 등록됐습니다.');

INSERT INTO NOTIFICATION (NOTIFICATIONID, BOARDTYPE, TYPE, MESSAGE)
VALUES (5, '질병', 'UPDATE', '질병 게시판에 정보가 수정됐습니다.');

INSERT INTO NOTIFICATION (NOTIFICATIONID, BOARDTYPE, TYPE, MESSAGE)
VALUES (6, '질병', 'DELETE', '질병 게시판에 정보가 삭제됐습니다.');

INSERT INTO NOTIFICATION (NOTIFICATIONID, BOARDTYPE, TYPE, MESSAGE)
VALUES (7, '사료', 'CREATE', '사료 게시판에 새로운 정보가 등록됐습니다.');

INSERT INTO NOTIFICATION (NOTIFICATIONID, BOARDTYPE, TYPE, MESSAGE)
VALUES (8, '사료', 'UPDATE', '사료 게시판에 정보가 업데이트됐습니다.');

INSERT INTO NOTIFICATION (NOTIFICATIONID, BOARDTYPE, TYPE, MESSAGE)
VALUES (9, '사료', 'DELETE', '사료 게시판에 정보가 삭제됐습니다.');

CREATE TABLE NOTIFICATION_SETTING (
    SETTINGID NUMBER PRIMARY KEY,       -- 설정 고유 ID
    USERID    NUMBER NOT NULL,          -- 사용자 ID (FK → USERS.USERID)
    TYPE      VARCHAR2(50) NOT NULL,    -- 알림 유형 (FK → NOTIFICATION.TYPE)
    ENABLED   CHAR(1) DEFAULT 'Y'       -- 알림 활성화 여부 (Y/N)
);

-- 외래키 추가
ALTER TABLE NOTIFICATION_SETTING
    ADD CONSTRAINT fk_notiset_user FOREIGN KEY (USERID)
        REFERENCES USERS (USERID);

ALTER TABLE NOTIFICATION_SETTING
    ADD CONSTRAINT fk_notiset_type FOREIGN KEY (TYPE)
        REFERENCES NOTIFICATION (TYPE);
