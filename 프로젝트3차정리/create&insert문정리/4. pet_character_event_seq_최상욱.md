
AI 캐릭터 생성 이벤트


이름              널?       유형            
--------------- -------- ------------- 
EVENTID         NOT NULL NUMBER        
USERID          NOT NULL NUMBER        
PROMPTTEXT      NOT NULL CLOB          
ORIGINIMAGEPATH NOT NULL VARCHAR2(300) 
AISTATUS        NOT NULL VARCHAR2(20)  
AIIMAGEURL               VARCHAR2(500) 
LIMITAI         NOT NULL NUMBER        
CREATEDAT       NOT NULL DATE  


---1 PETCHARACTEREVENT 테이블 재정의
CREATE TABLE PETCHARACTEREVENT (
    EVENTID          NUMBER          PRIMARY KEY NOT NULL,
    USERID           NUMBER          NOT NULL,
    PROMPTTEXT       CLOB            NOT NULL,
    ORIGINIMAGEPATH  VARCHAR2(300)   NOT NULL,

    AISTATUS         VARCHAR2(20)    DEFAULT 'REQUEST' NOT NULL,
    AIIMAGEURL       VARCHAR2(500),  -- NULL 허용

    LIMITAI          NUMBER          DEFAULT 1 NOT NULL,
    CREATEDAT        DATE            DEFAULT SYSDATE NOT NULL
);

desc PETCHARACTEREVENT;
create SEQUENCE PETCHARACTEREVENT_SEQ;



INSERT INTO PETCHARACTEREVENT (
    EVENTID,
    USERID,
    PROMPTTEXT,
    ORIGINIMAGEPATH,
    AISTATUS,
    AIIMAGEURL,
    LIMITAI,
    CREATEDAT
) VALUES (
    PETCHARACTEREVENT_SEQ.NEXTVAL,
    55023,
    'A vibrant pirate parrot captain with an eye patch, standing proudly on a wooden ship deck, watercolor illustration style.',
    '/uploads/2025/01/parrot_01.jpg',
    'REQUEST',
    NULL,
    1,
    SYSDATE
);

INSERT INTO PETCHARACTEREVENT (
    EVENTID,
    USERID,
    PROMPTTEXT,
    ORIGINIMAGEPATH,
    AISTATUS,
    AIIMAGEURL,
    LIMITAI,
    CREATEDAT
) VALUES (
    PETCHARACTEREVENT_SEQ.NEXTVAL,
    55023,
    'A heroic parrot dressed as a pirate captain, wearing a classic eye patch on a sailing ship deck, soft watercolor painting.',
    '/uploads/2025/01/parrot_02.jpg',
    'REQUEST',
    NULL,
    1,
    SYSDATE
);

INSERT INTO PETCHARACTEREVENT (
    EVENTID,
    USERID,
    PROMPTTEXT,
    ORIGINIMAGEPATH,
    AISTATUS,
    AIIMAGEURL,
    LIMITAI,
    CREATEDAT
) VALUES (
    PETCHARACTEREVENT_SEQ.NEXTVAL,
    55023,
    'A cheerful and bold pirate parrot captain with colorful feathers, standing on a wooden ship deck, fantasy watercolor style.',
    '/uploads/2025/01/parrot_03.jpg',
    'REQUEST',
    NULL,
    1,
    SYSDATE
);

INSERT INTO PETCHARACTEREVENT (
    EVENTID,
    USERID,
    PROMPTTEXT,
    ORIGINIMAGEPATH,
    AISTATUS,
    AIIMAGEURL,
    LIMITAI,
    CREATEDAT
) VALUES (
    PETCHARACTEREVENT_SEQ.NEXTVAL,
    55023,
    'A fantasy-style parrot pirate captain wearing an eye patch, posing confidently on a ship deck, detailed watercolor artwork.',
    '/uploads/2025/01/parrot_04.jpg',
    'REQUEST',
    NULL,
    1,
    SYSDATE
);

INSERT INTO PETCHARACTEREVENT (
    EVENTID,
    USERID,
    PROMPTTEXT,
    ORIGINIMAGEPATH,
    AISTATUS,
    AIIMAGEURL,
    LIMITAI,
    CREATEDAT
) VALUES (
    PETCHARACTEREVENT_SEQ.NEXTVAL,
    55023,
    'A charming pirate captain parrot with bright feathers and an eye patch, standing on a wooden ship deck, watercolor illustration.',
    '/uploads/2025/01/parrot_05.jpg',
    'REQUEST',
    NULL,
    1,
    SYSDATE
);





--------------------------------AISTATUS 상태 정의 (관리 기준)
REQUEST     : 생성 요청됨
PROCESSING  : OpenAI API 호출 중
SUCCESS     : 이미지 생성 완료
FAIL        : 생성 실패
---------------------------------

--- 캐릭터 삭제 DELETE
DELETE FROM PETCHARACTEREVENT
WHERE EVENTID = 9
  AND USERID  = 55023;


---------------------------UPDATE 구문 (OpenAI API 호출 시작 시)
UPDATE PETCHARACTEREVENT
SET AISTATUS = 'PROCESSING'
WHERE EVENTID = 4;
select * from PETCHARACTEREVENT;

---------------------------- UPDATE 구문 (OpenAI API 성공 시)
UPDATE PETCHARACTEREVENT
SET
    AISTATUS   = 'SUCCESS',
    AIIMAGEURL = 'https://cdn.openai.com/images/parrot_01.png',
    LIMITAI    = LIMITAI - 1
WHERE EVENTID = 8
  AND LIMITAI > 0;

----------------------------UPDATE 구문 (OpenAI API 실패 시)
UPDATE PETCHARACTEREVENT
SET
    AISTATUS   = 'FAIL',
    AIIMAGEURL = NULL
WHERE EVENTID = 6;


--- 실패 건 재생성 처리( LIMITAI 복구)
UPDATE PETCHARACTEREVENT
SET
    AIIMAGEURL = 'PROCESSING',
    LIMITAI = 1
WHERE EVENTID = 8
  AND AIIMAGEURL = 'FAIL';
  
  --- option 01
  UPDATE PETCHARACTEREVENT
SET
    AIIMAGEURL = NULL,
    LIMITAI = 1
WHERE
    EVENTID = 8
    AND LIMITAI = 0;

  
  --- option 02
  UPDATE PETCHARACTEREVENT
SET
    AIIMAGEURL = NULL,
    LIMITAI = 1
WHERE
    EVENTID = 8
    AND AIIMAGEURL = 'FAIL';


---------------------------- 관리자 조회 SQL (상태 기반)
---생성대기
SELECT *
FROM PETCHARACTEREVENT
WHERE AISTATUS = 'REQUEST';

---생성 중
SELECT *
FROM PETCHARACTEREVENT
WHERE AISTATUS = 'PROCESSING';

---생성 성공
SELECT *
FROM PETCHARACTEREVENT
WHERE AISTATUS = 'SUCCESS';

---생성 실패
SELECT *
FROM PETCHARACTEREVENT
WHERE AISTATUS = 'FAIL';
