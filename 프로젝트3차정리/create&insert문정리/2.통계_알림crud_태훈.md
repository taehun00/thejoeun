### 테이블 리셋
drop table authorities;
drop table pet;
drop table execboard;
drop table disease;
drop table reviewimg;
drop table review;
drop table users;

### 외래키 없는 테이블 + 외래키 추가(ALTER)문으로 만들었습니다.
CREATE TABLE USERS (
    USERID       NUMBER          PRIMARY KEY,         -- 기본키
    EMAIL        VARCHAR2(200)   NOT NULL UNIQUE,     -- 이메일 (유니크)
    NICKNAME     VARCHAR2(100)   NOT NULL,            -- 별명(이름)
    PASSWORD     VARCHAR2(100)   NOT NULL,            -- 비밀번호
    UFILE        VARCHAR2(255),                       -- 이미지 파일명
    CREATEDAT    DATE            DEFAULT SYSDATE,     -- 등록일
    MOBILE       VARCHAR2(200),                       -- 전화번호
    PROVIDER     VARCHAR2(50),                        -- 인증 제공자(local, google 등)
    PROVIDERID   VARCHAR2(100)                        -- 제공자 id
);

CREATE TABLE ROLES (
    AUTHID   NUMBER          PRIMARY KEY,     -- 권한 고유 ID
    EMAIL    VARCHAR2(100)   NOT NULL,        -- 사용자 이메일 (FK 아직 없음)
    AUTH     VARCHAR2(100)   NOT NULL         -- 권한 (예: ROLE_ADMIN, ROLE_MEMBER)
);
ALTER TABLE ROLES
    ADD CONSTRAINT fk_roles_email FOREIGN KEY (EMAIL)
        REFERENCES USERS (EMAIL);

CREATE TABLE PETS (
    PETID          NUMBER          PRIMARY KEY,        -- 반려동물 고유 ID
    USERID         NUMBER          NOT NULL,           -- 사용자 ID (FK → USERS.USERID)
    PETNAME        VARCHAR2(100)   NOT NULL,           -- 반려동물 이름
    PETBREED       VARCHAR2(100),                      -- 반려동물 종 (예: 페르시안, 푸들)
    BIRTHDATE      VARCHAR2(100),                      -- 생년월일 (문자열로 저장)
    PETTYPEID      NUMBER          NOT NULL,           -- 반려동물 종류 ID (FK → PETTYPE.PETTYPEID)
    PFILE          VARCHAR2(255),                      -- 반려동물 이미지 파일명
    CREATEDAT      DATE            DEFAULT SYSDATE,    -- 등록일
    AGE            NUMBER,                             -- 나이
    GENDER         VARCHAR2(10)                        -- 성별 (M/F)
);

(현재 사용안함)
    WEIGHT         NUMBER,                             -- 체중
    HEIGHT         NUMBER,                             -- 키/몸길이
    BODYSCORE      NUMBER,                             -- 비만지표 (1~5)
    ACTIVITYLEVEL  NUMBER                              -- 활동량 (1~3)
(현재 사용안함)

-- 외래키 제약조건 추가
ALTER TABLE PETS
    ADD CONSTRAINT fk_pets_userid FOREIGN KEY (USERID)
        REFERENCES USERS (USERID);

ALTER TABLE PETS
    ADD CONSTRAINT fk_pets_pettype FOREIGN KEY (PETTYPEID)
        REFERENCES PETTYPE (PETTYPEID);


CREATE TABLE PETDISEASE (
    PETID        NUMBER NOT NULL,      -- 반려동물 ID (FK 예정 → PETS.PETID)
    DISEASEID    NUMBER NOT NULL       -- 질병 ID (FK 예정 → DISEASE.DISNO)
);

-- PETS 테이블 참조
ALTER TABLE PETDISEASE
    ADD CONSTRAINT fk_petdisease_pet FOREIGN KEY (PETID)
        REFERENCES PETS (PETID);

-- DISEASE 테이블 참조
ALTER TABLE PETDISEASE
    ADD CONSTRAINT fk_petdisease_disease FOREIGN KEY (DISEASEID)
        REFERENCES DISEASE (DISNO);
        
CREATE TABLE PETFOOD (
    PETID     NUMBER NOT NULL,      -- 반려동물 ID (FK 예정 → PETS.PETID)
    FOODID    NUMBER NOT NULL       -- 음식 ID (FK 예정 → FOOD.FOODID)
);

-- PETS 테이블 참조
ALTER TABLE PETFOOD
    ADD CONSTRAINT fk_petfood_pet FOREIGN KEY (PETID)
        REFERENCES PETS (PETID);

-- FOOD 테이블 참조
ALTER TABLE PETFOOD
    ADD CONSTRAINT fk_petfood_food FOREIGN KEY (FOODID)
        REFERENCES FOOD (FOODID);

-- 좋아요 기록
CREATE TABLE POST_LIKE (
    LIKEID NUMBER PRIMARY KEY,
    POSTTYPE VARCHAR2(20) NOT NULL,   -- 'REVIEW', 'EXERCISE', 'DISEASE'
    POSTID NUMBER NOT NULL,           -- 해당 글 ID
    USERID NUMBER NOT NULL,           -- 좋아요 누른 사람
    CREATEDAT DATE DEFAULT SYSDATE
);

-- POST_LIKE 테이블 외래키 추가
ALTER TABLE POST_LIKE
ADD CONSTRAINT fk_postlike_user
FOREIGN KEY (USER_ID)
REFERENCES USER(USER_ID);

-- 알림 테이블 (좋아요 전용)
CREATE TABLE NOTIFICATION (
    NOTI_ID NUMBER PRIMARY KEY,        -- 알림 고유 ID
    USER_ID NUMBER NOT NULL,           -- 알림 받을 사람 (글 작성자)
    POST_TYPE VARCHAR2(20) NOT NULL,   -- 게시판 종류 ('REVIEW', 'EXERCISE', 'DISEASE')
    POST_ID NUMBER NOT NULL,           -- 알림이 발생한 글 ID
    ACTION_USER_ID NUMBER NOT NULL,    -- 행동을 한 사람 (좋아요 누른 유저)
    MESSAGE VARCHAR2(200),             -- 알림 내용
    CREATED_AT DATE DEFAULT SYSDATE    -- 알림 생성 시각
);


-- NOTIFICATION 테이블 외래키 추가 (알림 받을 사람)
ALTER TABLE NOTIFICATION
ADD CONSTRAINT fk_notification_user
FOREIGN KEY (USER_ID)
REFERENCES USER(USER_ID);

-- NOTIFICATION 테이블 외래키 추가 (행동을 한 사람)
ALTER TABLE NOTIFICATION
ADD CONSTRAINT fk_notification_action_user
FOREIGN KEY (ACTION_USER_ID)
REFERENCES USER(USER_ID);

-- 알림 설정 테이블 생성 (외래키 제외)
CREATE TABLE NOTIFICATION_SETTING (
    USER_ID NUMBER NOT NULL,           -- 사용자 ID
    BOARD_TYPE VARCHAR2(20) NOT NULL,  -- 게시판 종류 ('REVIEW', 'EXERCISE', 'DISEASE')
    ENABLED CHAR(1) DEFAULT 'Y',       -- 알림 여부 ('Y'=받음, 'N'=안 받음)
    PRIMARY KEY (USER_ID, BOARD_TYPE)
);

-- 외래키 제약 조건 추가
ALTER TABLE NOTIFICATION_SETTING
ADD CONSTRAINT fk_notisetting_user
FOREIGN KEY (USER_ID)
REFERENCES USERS(USERID);


