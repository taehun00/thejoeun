
### 테이블 리셋
drop table authorities;
drop table pet;
drop table execboard;
drop table disease;
drop table reviewimg;
drop table review;
drop table users;

### 외래키 없는 테이블 + 외래키 추가(ALTER)문으로 만들었습니다.
CREATE TABLE USERS (
    USERID     NUMBER GENERATED BY DEFAULT AS IDENTITY, -- PK, 자동 증가
    EMAIL      VARCHAR2(200) NOT NULL,                  -- 이메일
    NICKNAME   VARCHAR2(100) NOT NULL,                  -- 별명
    PASSWORD   VARCHAR2(100) NOT NULL,                  -- 비밀번호
    UFILE      VARCHAR2(255),                           -- 이미지 파일명
    CREATEDAT  DATE DEFAULT SYSDATE,                    -- 등록일
    MOBILE     VARCHAR2(200),                           -- 전화번호
    PROVIDER   VARCHAR2(50) NOT NULL,                   -- 인증 제공자(local, google, kakao 등)
    PROVIDERID VARCHAR2(100),                           -- 제공자 id
    CONSTRAINT pk_users PRIMARY KEY (USERID),
    CONSTRAINT uq_users_email_provider UNIQUE (EMAIL, PROVIDER)
);



CREATE TABLE ROLES (
    AUTHID   NUMBER          PRIMARY KEY,     -- 권한 고유 ID
    USERID   NUMBER          NOT NULL,
    EMAIL    VARCHAR2(100)   NOT NULL,        -- 사용자 이메일 (FK 아직 없음)
    AUTH     VARCHAR2(100)   NOT NULL         -- 권한 (예: ROLE_ADMIN, ROLE_MEMBER)
);
ALTER TABLE ROLES
    ADD CONSTRAINT FK_ROLES_USER FOREIGN KEY (USERID)
    REFERENCES USERS (USERID);


CREATE TABLE PETS (
    PETID          NUMBER          PRIMARY KEY,        -- 반려동물 고유 ID
    USERID         NUMBER          NOT NULL,           -- 사용자 ID (FK → USERS.USERID)
    PETNAME        VARCHAR2(100)   NOT NULL,           -- 반려동물 이름
    PETBREED       VARCHAR2(100),                      -- 반려동물 종 (예: 페르시안, 푸들)
    BIRTHDATE      VARCHAR2(100),                      -- 생년월일 (문자열로 저장)
    PETTYPEID      NUMBER          NOT NULL,           -- 반려동물 종류 ID (FK → PETTYPE.PETTYPEID)
    PFILE          VARCHAR2(255),                      -- 반려동물 이미지 파일명
    CREATEDAT      DATE            DEFAULT SYSDATE,    -- 등록일
    PAGE           NUMBER,                             -- 나이
    PGENDER        VARCHAR2(10)                        -- 성별 (M/F)
);

(현재 사용안함)
    WEIGHT         NUMBER,                             -- 체중
    HEIGHT         NUMBER,                             -- 키/몸길이
    BODYSCORE      NUMBER,                             -- 비만지표 (1~5)
    ACTIVITYLEVEL  NUMBER                              -- 활동량 (1~3)
(현재 사용안함)

-- 외래키 제약조건 추가
ALTER TABLE PETS
    ADD CONSTRAINT fk_pets_userid FOREIGN KEY (USERID)
        REFERENCES USERS (USERID);

ALTER TABLE PETS
    ADD CONSTRAINT fk_pets_pettype FOREIGN KEY (PETTYPEID)
        REFERENCES PETTYPE (PETTYPEID);


CREATE TABLE PETDISEASE (
    PETID        NUMBER NOT NULL,      -- 반려동물 ID (FK 예정 → PETS.PETID)
    DISEASEID    NUMBER NOT NULL       -- 질병 ID (FK 예정 → DISEASE.DISNO)
);

-- PETS 테이블 참조
ALTER TABLE PETDISEASE
    ADD CONSTRAINT fk_petdisease_pet FOREIGN KEY (PETID)
        REFERENCES PETS (PETID);

-- DISEASE 테이블 참조
ALTER TABLE PETDISEASE
    ADD CONSTRAINT fk_petdisease_disease FOREIGN KEY (DISEASEID)
        REFERENCES DISEASE (DISNO);
        
CREATE TABLE PETFOOD (
    PETID     NUMBER NOT NULL,      -- 반려동물 ID (FK 예정 → PETS.PETID)
    FOODID    NUMBER NOT NULL       -- 음식 ID (FK 예정 → FOOD.FOODID)
);

-- PETS 테이블 참조
ALTER TABLE PETFOOD
    ADD CONSTRAINT fk_petfood_pet FOREIGN KEY (PETID)
        REFERENCES PETS (PETID);

-- 공지사항 내용 db 저장 테이블
CREATE TABLE ANNOUNCEMENT (
    ID NUMBER PRIMARY KEY,
    MESSAGE VARCHAR2(1000) NOT NULL,
    CREATEDAT DATE DEFAULT SYSDATE
);

CREATE TABLE HIDDEN_ANNOUNCEMENT (
    USER_ID NUMBER NOT NULL,
    ANNOUNCEMENT_ID NUMBER NOT NULL,
    PRIMARY KEY (USER_ID, ANNOUNCEMENT_ID)
);


-- FOOD 테이블 참조
ALTER TABLE PETFOOD
    ADD CONSTRAINT fk_petfood_food FOREIGN KEY (FOODID)
        REFERENCES FOOD (FOODID);

-- 좋아요 기록 테이블
CREATE TABLE POST_LIKE (
    LIKEID    NUMBER        PRIMARY KEY,       -- 좋아요 고유 ID
    BOARDTYPE  VARCHAR2(20)  NOT NULL,          -- 'REVIEW', 'EXERCISE', 'DISEASE'
    POSTID    NUMBER        NOT NULL,          -- 해당 글 ID
    USERID    NUMBER        NOT NULL,          -- 좋아요 누른 사람
    CREATEDAT DATE          DEFAULT SYSDATE    -- 생성일
);

-- POSTLIKE 테이블 외래키 추가
ALTER TABLE POST_LIKE
ADD CONSTRAINT fk_postlike_user
FOREIGN KEY (USERID)
REFERENCES USERS(USERID);

-- 알림 설정 테이블
CREATE TABLE NOTIFICATION_SETTING (
    USERID    NUMBER        NOT NULL,          -- 사용자 ID
    BOARDTYPE VARCHAR2(20)  NOT NULL,          -- 게시판 종류 ('REVIEW', 'EXERCISE', 'DISEASE')
    ENABLED   VARCHAR2(1)       DEFAULT 'Y',       -- 알림 여부 ('Y'=받음, 'N'=안 받음)
    PRIMARY KEY (USERID, BOARDTYPE)
);

-- 외래키 제약 조건 추가
ALTER TABLE NOTIFICATION_SETTING
ADD CONSTRAINT fk_notisetting_user
FOREIGN KEY (USERID)
REFERENCES USERS(USERID);
