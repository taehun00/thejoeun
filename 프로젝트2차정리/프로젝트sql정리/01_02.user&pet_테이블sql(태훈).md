# USERS 테이블 + sequence (user_seq)

| 컬럼명        | 데이터 타입         | 제약 조건                 | 설명 |
|--------------|-------------------|--------------------------|------|
| `userid`     | `NUMBER`          | `PRIMARY KEY`            | 사용자 고유 ID |
| `email`      | `VARCHAR2(200)`   | `NOT NULL`, `UNIQUE`     | 이메일 주소 |
| `nickname`   | `VARCHAR2(100)`   | `NOT NULL`               | 닉네임 |
| `password`   | `VARCHAR2(100)`   | `NOT NULL`               | 비밀번호 |
| `ufile`      | `VARCHAR2(255)`   | `DEFAULT 'default.png'`  | 이미지파일 |
| `createdat`  | `DATE`            | `NOT NULL`               | 가입일 |
| `mobile`     | `VARCHAR2(200)`   | `NULL`, `UNIQUE`         | 폰번호 |


### 회원가입(사용자)(관리자)
INSERT INTO users (userid, email, nickname, password, ufile, createdat)
           VALUES (users_seq.NEXTVAL, ?, ?, ?, ?, SYSDATE);

### 로그인(사용자)(관리자)
SELECT COUNT(*) FROM users WHERE email=? AND password=?;

> ★security (username, password, 권한들)
  select     u.email, password, auth
  from       appuser u    left join   authorities a   on  u.email = a.email  
  where      u.email=#{email} 
 


### 마이페이지(사용자)(관리자)
select * from users where email=?;

### 아이디 찾기(사용자)(관리자)(임시)
SELECT email
FROM users
WHERE nickname = ?;


### 비밀번호 찾기(사용자)(관리자)(임시)
SELECT password
FROM users
WHERE nickname = ? AND email = ?;

### 정보수정(사용자)
UPDATE users
SET email    = ?,
    nickname = ?, 
    password = ?
WHERE email = ?;

### 회원탈퇴(사용자)(관리자)
delete from users where email = ?      and password = ?;   > ★ password? 

### 전체유저 정보확인(관리자)  ★페이징
SELECT *
FROM users
ORDER BY createdat desc;

select  *
from  (
    select     row_number()   over (  order by  created_at desc )  as  rnum , 
    id  , app_user_id , btitle, bcontent, bpass, bfile,  bip , bhit, created_at
    from sboard1
)  A
where   A.rnum  between  #{start}   and #{end}


### 해당 유저 검색(관리자)

<!-- 이메일로 검색 -->
SELECT u.userid,
       u.email,
       u.nickname,
       u.createdat
FROM users u
WHERE u.email LIKE '%' || ? || '%'
ORDER BY u.createdat DESC;


<!-- 닉네임으로 검색 -->
SELECT u.userid,
       u.email,
       u.nickname,
       u.createdat
FROM users u
WHERE u.nickname LIKE '%' || ? || '%'
ORDER BY u.createdat DESC;

>  ★동적 mybatis

# PETTYPE 테이블
| 컬럼명           | 데이터 타입       | 제약 조건         | 설명 |
|-----------------|-------------------|------------------|------|
| `pettypeid`     | `NUMBER`          | `PRIMARY KEY`    | 반려동물 종류 ID |
| `pettypename`   | `VARCHAR2(100)`   | `NOT NULL`       | 종류 이름 (강아지, 고양이 등) |

# PET 테이블 + sequence (pet_seq)

| 컬럼명        | 데이터 타입       | 제약 조건                                | 설명 |
|---------------|-------------------|------------------------------------------|------|
| `petid`       | `NUMBER`          | `PRIMARY KEY`                            | 반려동물 고유 ID |
| `userid`       | `NUMBER`          | `FOREIGN KEY REFERENCES user(userid)`    | 사용자 ID |
| `petname`     | `VARCHAR2(100)`   | `NOT NULL`                               | 반려동물 이름 |
| `petbreed`    | `VARCHAR2(100)`   | `NOT NULL`                                | 반려동물 종 |
| `birthdate`    | `VARCHAR2(100)`   | —                                        | 생년월일 |
| `pettypeid`  | `NUMBER`          | `FOREIGN KEY REFERENCES pettype(pet_type_id)` | 반려동물 종류 ID |
| `ufile`      | `VARCHAR2(255)`   | `DEFAULT 'default.png'`                    | 반려동물 이미지파일 |
| `createdat`  | `DATE`            | `NOT NULL`                                 | 반려동물등록일 |


### 펫 정보 작성(사용자)

INSERT INTO pet (petid, userid, petname, petbreed, birthdate, pettypeid, createdat, ufile)
VALUES (pet_seq.NEXTVAL, ?, ?, ?, ?, ?, SYSDATE, ?);

INSERT INTO pet (petid, userid, petname, petbreed, birthdate, pettypeid, createdat, ufile)
VALUES (pet_seq.NEXTVAL, 1, '겨울이', '페르시안', '2022-06-12', 1, SYSDATE, DEFAULT);

### 펫 페이지(로그인 시 해당유저의 전체펫 조회)(사용자)

SELECT p.petid,
       p.petname,
       p.petbreed,
       p.birthdate,
       p.pettypeid,
       p.createdat,
       p.ufile
FROM pet p
JOIN users u ON p.userid = u.userid
WHERE u.email = ?   -- 로그인한 유저 이메일
ORDER BY p.createdat DESC;

### 전체 펫 페이지(관리자) 
> ★페이징

SELECT p.petid,
       u.email,
       p.petname,
       p.petbreed,
       p.birthdate,
       p.pettypeid,
       p.createdat,
       p.ufile
FROM pet p
JOIN users u ON p.userid = u.userid
ORDER BY p.createdat DESC;

select  *
from  (
    select     row_number()   over (  order by  created_at desc )  as  rnum , 
    id  , app_user_id , btitle, bcontent, bpass, bfile,  bip , bhit, created_at
    from sboard1
)  A
where   A.rnum  between  #{start}   and #{end}




### 상세페이지(로그인 시 해당유저의 상세펫 조회)(사용자)

SELECT p.petid,
       p.petname,
       p.petbreed,
       p.birthdate,
       p.pettypeid,
       p.createdat,
       p.ufile
FROM pet p
JOIN users u ON p.userid = u.userid
WHERE u.email = ?   -- 로그인한 유저 이메일
  AND p.petid = ?;  -- 선택한 펫 ID



> ★마이바티스 - 동적

### 펫 정보 수정(사용자)(관리자)

<!-- 사용자 -->

<!-- 관리자 -->
UPDATE pet
SET petname   = ?,
    petbreed  = ?,
    birthdate = ?,
    pettypeid = ?,
    ufile     = ?
WHERE petid   = ?;

### 펫 정보 삭제(사용자)(관리자)
<!-- 관리자 -->
DELETE FROM pet
WHERE petid = ?;

### 검색 기능(관리자)
#### (이메일)
SELECT p.petid, u.email, p.petname, p.petbreed, p.birthdate, p.pettypeid, p.createdat, p.ufile
FROM pet p
JOIN users u ON p.userid = u.userid
WHERE u.email LIKE '%' || ? || '%'
ORDER BY u.createdat DESC;

#### (펫이름)
SELECT p.petid, u.email, p.petname, p.petbreed, p.birthdate, p.pettypeid, p.createdat, p.ufile
FROM pet p
JOIN users u ON p.userid = u.userid
WHERE p.petname LIKE '%' || ? || '%'
ORDER BY u.createdat DESC;